<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SPK Organisasi Mahasiswa</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <style>
      * {
        font-family: "Inter", sans-serif;
      }

      :root {
        --primary-color: #6366f1;
        --secondary-color: #8b5cf6;
        --accent-color: #06b6d4;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --dark-bg: #0f172a;
        --card-bg: #1e293b;
        --border-color: #334155;
        --text-primary: #f1f5f9;
        --text-secondary: #cbd5e1;
        --glass-bg: rgba(30, 41, 59, 0.7);
      }

      body {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
        min-height: 100vh;
        color: var(--text-primary);
        position: relative;
        overflow-x: hidden;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 40% 80%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
        pointer-events: none;
        z-index: -1;
      }

      .header-custom {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        padding: 4rem 0;
        position: relative;
        overflow: hidden;
      }

      .header-custom::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
          repeat;
        opacity: 0.1;
      }

      .header-content {
        position: relative;
        z-index: 2;
      }

      .hero-title {
        font-size: 3.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 1rem;
      }

      .hero-subtitle {
        font-size: 1.25rem;
        font-weight: 400;
        opacity: 0.9;
        margin-bottom: 2rem;
      }

      .stats-card {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
      }

      .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }

      .main-content {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        margin-top: -80px;
        position: relative;
        z-index: 10;
      }

      .info-box {
        background: linear-gradient(135deg, var(--accent-color) 0%, var(--success-color) 100%);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
      }

      .info-box::before {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        transform: translate(30px, -30px);
      }

      .scale-item {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 0.75rem 1rem;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        transition: all 0.3s ease;
      }

      .scale-item:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateX(5px);
      }

      .scale-number {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-weight: 600;
      }

      .custom-fieldset {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .custom-fieldset:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
      }

      .custom-fieldset::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
      }

      .form-floating {
        margin-bottom: 1.5rem;
      }

      .form-control {
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        border-radius: 12px;
        padding: 1rem;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
      }

      .form-control:focus {
        background: rgba(15, 23, 42, 0.9);
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.25rem rgba(99, 102, 241, 0.25);
        color: var(--text-primary);
      }

      .form-control::placeholder {
        color: var(--text-secondary);
      }

      .form-label {
        color: var(--text-primary);
        font-weight: 500;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .form-label i {
        color: var(--primary-color);
        font-size: 1.1rem;
      }

      .btn-modern {
        padding: 0.75rem 2rem;
        border-radius: 12px;
        font-weight: 500;
        border: none;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.9rem;
      }

      .btn-primary-modern {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
      }

      .btn-primary-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 30px rgba(99, 102, 241, 0.4);
        color: white;
      }

      .btn-success-modern {
        background: linear-gradient(135deg, var(--success-color) 0%, var(--accent-color) 100%);
        color: white;
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
      }

      .btn-success-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 30px rgba(16, 185, 129, 0.4);
        color: white;
      }

      .btn-danger-modern {
        background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);
        color: white;
        box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
      }

      .btn-danger-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 30px rgba(239, 68, 68, 0.4);
        color: white;
      }

      .legend-modern {
        color: var(--text-primary);
        font-size: 1.5rem;
        font-weight: 600;
        text-align: center;
        margin-bottom: 2rem;
        position: relative;
        padding-bottom: 1rem;
      }

      .legend-modern::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 3px;
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        border-radius: 2px;
      }

      .result-section {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 2rem;
        margin-top: 3rem;
      }

      .calculation-section {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 2rem;
        margin-top: 2rem;
      }

      .table-modern {
        background: transparent;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .table-modern thead th {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border: none;
        padding: 1.25rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.9rem;
      }

      .table-modern tbody td {
        background: rgba(30, 41, 59, 0.8);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        padding: 1.25rem;
        font-weight: 500;
      }

      .table-modern tbody tr:hover td {
        background: rgba(99, 102, 241, 0.1);
      }

      .highlight-row td {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(6, 182, 212, 0.2) 100%) !important;
        border-color: var(--success-color) !important;
        position: relative;
      }

      .highlight-row td::before {
        content: "🏆";
        position: absolute;
        left: 0.5rem;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.2rem;
      }

      .highlight-row td:first-child {
        padding-left: 2.5rem;
      }

      .rank-badge {
        background: linear-gradient(135deg, var(--warning-color) 0%, #f97316 100%);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        display: inline-block;
        min-width: 40px;
        text-align: center;
      }

      .score-badge {
        background: linear-gradient(135deg, var(--success-color) 0%, var(--accent-color) 100%);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .criteria-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
      }

      .criteria-card {
        background: rgba(15, 23, 42, 0.5);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.5rem;
        transition: all 0.3s ease;
      }

      .criteria-card:hover {
        transform: translateY(-2px);
        border-color: var(--primary-color);
        box-shadow: 0 8px 20px rgba(99, 102, 241, 0.2);
      }

      .floating-action {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 1000;
      }

      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--text-secondary);
      }

      .empty-state i {
        font-size: 4rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
      }

      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
      }

      .toast-custom {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-primary);
      }

      @media (max-width: 768px) {
        .hero-title {
          font-size: 2.5rem;
        }

        .criteria-grid {
          grid-template-columns: 1fr;
        }

        .floating-action {
          bottom: 1rem;
          right: 1rem;
        }
      }

      .animate-fade-in {
        animation: fadeIn 0.6s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .calculation-steps {
        background: rgba(15, 23, 42, 0.5);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .step-title {
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      /* Additional CSS for smooth scrolling button */
      #floatingBtn {
        display: none;
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 50%;
        width: 56px;
        height: 56px;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        transition: opacity 0.3s ease;
        z-index: 1000;
      }

      #floatingBtn i {
        font-size: 1.5rem;
      }
    </style>
  </head>
  <body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <header class="header-custom">
      <div class="container header-content">
        <div class="row align-items-center">
          <div class="col-lg-8">
            <h1 class="hero-title">Sistem Pendukung Keputusan</h1>
            <p class="hero-subtitle">Rekomendasi Organisasi Mahasiswa dengan Metode MAUT</p>
            <div class="d-flex gap-3 mb-4">
              <div class="stats-card">
                <i class="bi bi-building text-primary fs-3 mb-2"></i>
                <div class="fw-bold">Multi-Criteria</div>
                <small class="text-muted">Analysis</small>
              </div>
              <div class="stats-card">
                <i class="bi bi-graph-up text-success fs-3 mb-2"></i>
                <div class="fw-bold">MAUT Method</div>
                <small class="text-muted">Algorithm</small>
              </div>
              <div class="stats-card">
                <i class="bi bi-award text-warning fs-3 mb-2"></i>
                <div class="fw-bold">Best Choice</div>
                <small class="text-muted">Recommendation</small>
              </div>
            </div>
          </div>
          <div class="col-lg-4 text-center">
            <i class="bi bi-mortarboard display-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </header>

    <div class="container">
      <main class="main-content p-4 p-lg-5">
        <div class="info-box">
          <div class="row align-items-center">
            <div class="col-lg-8">
              <h3 class="fw-bold mb-3">
                <i class="bi bi-info-circle me-2"></i>
                Keterangan Skala Penilaian (Benefit)
              </h3>
              <div class="row">
                <div class="col-md-6">
                  <div class="scale-item">
                    <div class="scale-number">1</div>
                    <span>Sangat Kurang</span>
                  </div>
                  <div class="scale-item">
                    <div class="scale-number">2</div>
                    <span>Kurang</span>
                  </div>
                  <div class="scale-item">
                    <div class="scale-number">3</div>
                    <span>Cukup</span>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="scale-item">
                    <div class="scale-number">4</div>
                    <span>Baik</span>
                  </div>
                  <div class="scale-item">
                    <div class="scale-number">5</div>
                    <span>Sangat Baik</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-4 text-center">
              <i class="bi bi-clipboard-data display-4 opacity-75"></i>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">
            <i class="bi bi-pencil-square text-primary me-2"></i>
            Form Penilaian Organisasi
          </h2>
          <div class="d-flex gap-2">
            <button class="btn btn-primary-modern btn-modern" onclick="addForm()"><i class="bi bi-plus-circle me-2"></i>Tambah Organisasi</button>
          </div>
        </div>

        <div id="formContainer">
          <div class="empty-state" id="emptyState">
            <i class="bi bi-inbox"></i>
            <h4>Belum Ada Organisasi</h4>
            <p>Klik tombol "Tambah Organisasi" untuk mulai menambahkan data organisasi yang akan dinilai.</p>
          </div>
        </div>

        <div class="text-center mt-4" id="processButton" style="display: none">
          <button class="btn btn-success-modern btn-modern btn-lg" onclick="calculateMAUT()"><i class="bi bi-calculator me-2"></i>Proses Rekomendasi</button>
        </div>

        <!-- Calculation Section -->
        <div id="calculationSection" class="calculation-section" style="display: none">
          <h2 class="mb-4">
            <i class="bi bi-gear text-info me-2"></i>
            Langkah Perhitungan MAUT
          </h2>
          <div id="calculationSteps"></div>
        </div>

        <!-- Result Section -->
        <div id="resultSection" class="result-section" style="display: none">
          <h2 class="mb-4">
            <i class="bi bi-trophy text-warning me-2"></i>
            Hasil Rekomendasi
          </h2>
          <div class="table-responsive">
            <table class="table table-modern">
              <thead>
                <tr>
                  <th><i class="bi bi-building me-2"></i>Nama Organisasi</th>
                  <th><i class="bi bi-graph-up me-2"></i>Skor MAUT</th>
                  <th><i class="bi bi-award me-2"></i>Peringkat</th>
                </tr>
              </thead>
              <tbody id="resultBody"></tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <!-- Floating Action Button -->
    <div class="floating-action" id="floatingBtn" style="display: none">
      <button class="btn btn-primary-modern btn-modern rounded-circle p-3" onclick="scrollToTop()">
        <i class="bi bi-arrow-up fs-5"></i>
      </button>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // ============ MAUT CALCULATION LOGIC ============

      // Bobot kriteria (total = 1.0)
      const weights = {
        c1: 0.1, // Kesesuaian Minat
        c2: 0.1, // Reputasi Organisasi
        c3: 0.1, // Potensi Pengembangan Diri
        c4: 0.1, // Fleksibilitas Jadwal
        c5: 0.1, // Kekompakan Anggota
        c6: 0.11, // Struktur Organisasi
        c7: 0.1, // Jaringan & Koneksi
        c8: 0.11, // Kualitas Fasilitas
        c9: 0.09, // Kemudahan Bergabung
        c10: 0.09, // Biaya & Pengeluaran (cost criteria)
      };

      // Label kriteria
      const criteriaLabels = {
        c1: { name: "Kesesuaian Minat", icon: "bi-heart", type: "benefit" },
        c2: { name: "Reputasi Organisasi", icon: "bi-star", type: "benefit" },
        c3: { name: "Potensi Pengembangan Diri", icon: "bi-graph-up", type: "benefit" },
        c4: { name: "Fleksibilitas Jadwal", icon: "bi-calendar-check", type: "benefit" },
        c5: { name: "Kekompakan Anggota", icon: "bi-people", type: "benefit" },
        c6: { name: "Struktur Organisasi", icon: "bi-diagram-3", type: "benefit" },
        c7: { name: "Jaringan & Koneksi", icon: "bi-globe", type: "benefit" },
        c8: { name: "Kualitas Fasilitas", icon: "bi-tools", type: "benefit" },
        c9: { name: "Kemudahan Bergabung", icon: "bi-door-open", type: "benefit" },
        c10: { name: "Biaya & Pengeluaran", icon: "bi-cash", type: "cost" },
      };

      let count = 0;

      // Function untuk menambah form organisasi
      function addForm() {
        count++;
        const container = document.getElementById("formContainer");
        const emptyState = document.getElementById("emptyState");
        const processButton = document.getElementById("processButton");

        // Hide empty state and show process button
        if (emptyState) emptyState.style.display = "none";
        if (processButton) processButton.style.display = "block";

        const fieldset = document.createElement("fieldset");
        fieldset.className = "animate-fade-in";

        fieldset.innerHTML = `
              <div class="custom-fieldset">
                  <div class="legend-modern">
                      <i class="bi bi-building text-primary me-2"></i>
                      Organisasi ${count}
                  </div>
                  
                  <div class="mb-4">
                      <label class="form-label">
                          <i class="bi bi-tag"></i>
                          Nama Organisasi
                      </label>
                      <input type="text" class="org-name form-control" placeholder="Masukkan nama organisasi..." required>
                  </div>
                  
                  <div class="criteria-grid">
                      ${Object.entries(criteriaLabels)
                        .map(
                          ([key, info]) => `
                          <div class="criteria-card">
                              <label class="form-label">
                                  <i class="bi ${info.icon}"></i>
                                  ${info.name}
                              </label>
                              <input type="number" 
                                  class="${key} form-control" 
                                  min="1" 
                                  max="5"
                                  placeholder="1-5"
                                  onchange="validateInput(this)"
                                  oninput="validateInput(this)"
                                  required>
                              <small class="text-muted">Nilai 1-5</small>
                          </div>
                      `
                        )
                        .join("")}
                  </div>
                  
                  <div class="text-end mt-4">
                      <button class="btn btn-danger-modern btn-modern" onclick="deleteForm(this)">
                          <i class="bi bi-trash me-2"></i>Hapus Organisasi
                      </button>
                  </div>
              </div>
          `;

        container.appendChild(fieldset);

        // Add smooth scrolling to the newly added form
        fieldset.scrollIntoView({
          behavior: "smooth",
          block: "start",
        });
      }

      // Function untuk validasi input
      function validateInput(input) {
        let value = parseInt(input.value);

        // Jika input kosong atau bukan angka, biarkan kosong
        if (input.value === "" || isNaN(value)) {
          return;
        }

        // Batasi nilai antara 1-5
        if (value < 1) {
          value = 1;
        } else if (value > 5) {
          value = 5;
        }

        input.value = value;
      }

      // Function untuk menghapus form
      function deleteForm(button) {
        const fieldset = button.closest("fieldset");
        if (fieldset) {
          if (confirm("Apakah Anda yakin ingin menghapus organisasi ini?")) {
            fieldset.remove();

            // Check if there are no more forms
            const container = document.getElementById("formContainer");
            const emptyState = document.getElementById("emptyState");
            const processButton = document.getElementById("processButton");

            if (container.children.length === 0) {
              if (emptyState) emptyState.style.display = "block";
              if (processButton) processButton.style.display = "none";
              count = 0; // Reset counter when all forms are deleted
            }
          }
        }
      }

      /**
       * Menghitung nilai utilitas menggunakan fungsi linear
       * @param {number} value - nilai kriteria
       * @param {number} min - nilai minimum
       * @param {number} max - nilai maksimum
       * @param {string} type - tipe kriteria (benefit/cost)
       */

      /**
       * Menghitung skor MAUT untuk satu alternatif
       * @param {object} values - nilai kriteria untuk alternatif
       * @param {object} criteriaStats - statistik min/max untuk setiap kriteria
       */
      function calculateMAUTScore(values, criteriaStats) {
        let totalScore = 0;
        const utilities = {};

        // Hitung utilitas untuk setiap kriteria
        Object.keys(values).forEach((criteriaKey) => {
          const value = values[criteriaKey];
          const stats = criteriaStats[criteriaKey];
          const criteriaType = criteriaLabels[criteriaKey].type;

          // Hitung nilai utilitas
          const utility = calculateUtility(value, stats.min, stats.max, criteriaType);
          utilities[criteriaKey] = utility;

          // Kalikan dengan bobot dan tambahkan ke total skor
          const weightedUtility = utility * weights[criteriaKey];
          totalScore += weightedUtility;
        });

        return { score: totalScore, utilities };
      }

      // Step 1: Fix the normalize function
      function normalize(value, min, max) {
        if (max === min) {
          return 1;
        }
        // Ensure numbers
        value = Number(value);
        min = Number(min);
        max = Number(max);

        return (value - min) / (max - min);
      }

      // Step 2: Fix utility calculation
      function calculateUtility(value, weight) {
        return value * weight;
      }

      // Step 3: Fix the main calculation in calculateMAUT()
      function calculateMAUT() {
        const fieldsets = document.querySelectorAll("fieldset");

        // Validate minimum organizations
        if (fieldsets.length === 0) {
          showToast("Mohon tambahkan minimal 1 organisasi", "warning");
          return;
        }

        // Validate all inputs are filled
        let isValid = true;
        let emptyFields = [];

        fieldsets.forEach((fs) => {
          const name = fs.querySelector(".org-name").value.trim();
          if (!name) {
            isValid = false;
            emptyFields.push("Nama Organisasi");
          }

          Object.keys(criteriaLabels).forEach((key) => {
            const value = fs.querySelector(`.${key}`).value;
            if (!value) {
              isValid = false;
              emptyFields.push(criteriaLabels[key].name);
            }
          });
        });

        if (!isValid) {
          showToast(`Mohon lengkapi semua field: ${[...new Set(emptyFields)].join(", ")}`, "error");
          return;
        }

        const results = [];
        const criteriaData = {};

        // Step 1: Collect min/max for each criteria
        Object.keys(criteriaLabels).forEach((key) => {
          criteriaData[key] = {
            values: [],
            min: Infinity,
            max: -Infinity,
          };
        });

        // Collect all values and find min/max
        fieldsets.forEach((fs) => {
          Object.keys(criteriaLabels).forEach((key) => {
            const value = Number(fs.querySelector(`.${key}`).value);
            criteriaData[key].values.push(value);
            criteriaData[key].min = Math.min(criteriaData[key].min, value);
            criteriaData[key].max = Math.max(criteriaData[key].max, value);
          });
        });

        // Calculate for each alternative
        fieldsets.forEach((fs) => {
          const name = fs.querySelector(".org-name").value.trim();
          const values = {};
          const normalizedValues = {};
          const weightedValues = {};
          let totalScore = 0;

          // Get original values
          Object.keys(criteriaLabels).forEach((key) => {
            values[key] = Number(fs.querySelector(`.${key}`).value);
          });

          // Calculate normalized values and weighted values
          Object.keys(values).forEach((key) => {
            // Step 1: Normalize
            normalizedValues[key] = normalize(values[key], criteriaData[key].min, criteriaData[key].max);

            // Step 2: Calculate weighted values using predefined weights
            weightedValues[key] = calculateUtility(normalizedValues[key], weights[key]);
            totalScore += weightedValues[key];
          });

          results.push({
            name,
            values, // Original values
            normalizedValues, // Normalized values
            weightedValues, // Weighted values
            totalScore,
          });
        });

        // Sort results
        results.sort((a, b) => b.totalScore - a.totalScore);

        // Display results with separated normalization and utility
        displayDetailedResults(results);
        updateResultTable(results);

        // Show floating button after calculation
        document.getElementById("floatingBtn").style.display = "block";
      }

      // Step 4: Update the display function to show correct values
      function displayDetailedResults(results) {
        const resultSection = document.getElementById("calculationSection");

        let html = `
            <div class="calculation-steps">
                <h3 class="step-title"><i class="bi bi-1-circle"></i> Bobot Kriteria</h3>
                <div class="table-responsive">
                    <table class="table table-modern">
                        <thead>
                            <tr>
                                ${Object.keys(criteriaLabels)
                                  .map((key) => `<th>${criteriaLabels[key].name}</th>`)
                                  .join("")}
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            ${Object.keys(weights)
                              .map((key) => `<td>${weights[key].toFixed(4)}</td>`)
                              .join("")}
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="calculation-steps">
            <h3 class="step-title"><i class="bi bi-2-circle"></i> Nilai Kriteria</h3>
            <div class="table-responsive">
                <table class="table table-modern">
                    <thead>
                        <tr>
                            <th>Organisasi</th>
                            ${Object.keys(criteriaLabels)
                              .map((key) => `<th>${criteriaLabels[key].name}</th>`)
                              .join("")}
                        </tr>
                    </thead>
                    <tbody>
                        ${results
                          .map(
                            (result) => `
                            <tr>
                                <td>${result.name}</td>
                                ${Object.keys(result.values)
                                  .map((key) => `<td>${result.values[key]}</td>`)
                                  .join("")}
                            </tr>
                        `
                          )
                          .join("")}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="calculation-steps">
            <h3 class="step-title"><i class="bi bi-3-circle"></i> Nilai Normalisasi</h3>
            <div class="table-responsive">
                <table class="table table-modern">
                    <thead>
                        <tr>
                            <th>Organisasi</th>
                            ${Object.keys(criteriaLabels)
                              .map((key) => `<th>${criteriaLabels[key].name}</th>`)
                              .join("")}
                        </tr>
                    </thead>
                    <tbody>
                        ${results
                          .map(
                            (result) => `
                            <tr>
                                <td>${result.name}</td>
                                ${Object.keys(result.normalizedValues)
                                  .map((key) => `<td>${result.normalizedValues[key].toFixed(4)}</td>`)
                                  .join("")}
                            </tr>
                        `
                          )
                          .join("")}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="calculation-steps">
            <h3 class="step-title"><i class="bi bi-4-circle"></i> Weighted Utility</h3>
            <div class="table-responsive">
                <table class="table table-modern">
                    <thead>
                        <tr>
                            <th>Organisasi</th>
                            ${Object.keys(criteriaLabels)
                              .map((key) => `<th>${criteriaLabels[key].name}</th>`)
                              .join("")}
                            <th>Total Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${results
                          .map(
                            (result) => `
                            <tr class="${result === results[0] ? "highlight-row" : ""}">
                                <td>${result.name}</td>
                                ${Object.keys(result.weightedValues)
                                  .map((key) => `<td>${result.weightedValues[key].toFixed(4)}</td>`)
                                  .join("")}
                                <td class="fw-bold">${result.totalScore.toFixed(4)}</td>
                            </tr>
                        `
                          )
                          .join("")}
                    </tbody>
                </table>
            </div>
        </div>
    `;

        resultSection.innerHTML = html;
      }

      // Add this function for updating the result table
      function updateResultTable(results) {
        // Get result section and table body
        const resultSection = document.getElementById("resultSection");
        const resultBody = document.getElementById("resultBody");

        // Show result section
        resultSection.style.display = "block";
        document.getElementById("calculationSection").style.display = "block";

        // Update table content
        resultBody.innerHTML = results
          .map(
            (result, index) => `
              <tr class="${index === 0 ? "highlight-row" : ""}">
                  <td>${result.name}</td>
                  <td><span class="score-badge">${result.totalScore.toFixed(4)}</span></td>
                  <td><span class="rank-badge">${index + 1}</span></td>
              </tr>
          `
          )
          .join("");

        // Scroll to results
        resultSection.scrollIntoView({
          behavior: "smooth",
          block: "start",
        });
      }

      // Add this function after your existing JavaScript code
      function showToast(message, type = "info") {
        const toastContainer = document.getElementById("toastContainer");
        const toastId = `toast-${Date.now()}`;

        const toast = document.createElement("div");
        toast.className = `toast toast-custom animate-fade-in`;
        toast.setAttribute("role", "alert");
        toast.setAttribute("aria-live", "assertive");
        toast.setAttribute("aria-atomic", "true");
        toast.id = toastId;

        // Set background color based on type
        let iconClass = "";
        switch (type) {
          case "success":
            iconClass = "bi-check-circle text-success";
            break;
          case "warning":
            iconClass = "bi-exclamation-triangle text-warning";
            break;
          case "error":
            iconClass = "bi-x-circle text-danger";
            break;
          default:
            iconClass = "bi-info-circle text-info";
        }

        toast.innerHTML = `
              <div class="toast-header">
                  <i class="bi ${iconClass} me-2"></i>
                  <strong class="me-auto">Notifikasi</strong>
                  <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
              </div>
              <div class="toast-body">
                  ${message}
              </div>
          `;

        toastContainer.appendChild(toast);

        const bsToast = new bootstrap.Toast(toast, {
          animation: true,
          autohide: true,
          delay: 3000,
        });

        bsToast.show();

        // Remove toast after it's hidden
        toast.addEventListener("hidden.bs.toast", () => {
          toast.remove();
        });
      }

      // Add this code after your existing JavaScript functions
      function scrollToTop() {
        window.scrollTo({
          top: 0,
          behavior: "smooth",
        });
      }

      // Add scroll event listener to show/hide floating button
      window.addEventListener("scroll", () => {
        const floatingBtn = document.getElementById("floatingBtn");

        // Show button when page is scrolled down 300px
        if (window.scrollY > 300) {
          floatingBtn.style.display = "block";
          floatingBtn.style.opacity = "1";
        } else {
          floatingBtn.style.opacity = "0";
          setTimeout(() => {
            if (window.scrollY <= 300) {
              floatingBtn.style.display = "none";
            }
          }, 300);
        }
      });
    </script>
  </body>
</html>
